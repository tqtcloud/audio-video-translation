# 开发指南

## 理念

### 核心理念

- **循序渐进，而非一蹴而就** - 少量修改，编译通过并测试通过
- **借鉴现有代码** - 实施前进行研究和规划
- **务实，而非教条** - 适应项目实际情况
- **清晰的意图，而非巧妙的代码** - 尽量简洁明了
- **任务开发完成及时更新 .kiro/ 下的任务文档** - 同步任务完成状态

### 简洁意味着

- 每个函数/类的职责单一
- 避免过早的抽象
- 不要耍小聪明，选择简洁的解决方案
- 如果需要解释，则说明它太复杂了

## 流程

### 1. 规划与阶段

将复杂的工作分解为 3-5 个阶段。 `IMPLEMENTATION_PLAN.md` 中的文档：

```markdown
## 阶段 N：[名称]
**目标**：[具体可交付成果]
**成功标准**：[可测试结果]
**测试**：[具体测试用例]
**状态**：[未开始|进行中|完成]
```
- 随着进度更新状态
- 所有阶段完成后删除文件

### 2. 实施流程

1. **理解** - 研究代码库中的现有模式
2. **测试** - 首先编写测试（红色）
3. **实施** - 需要通过的最少代码（绿色）
4. **重构** - 测试通过后进行清理
5. **提交** - 清晰地链接到计划

### 3. 卡住时（尝试 3 次后）

**严重**：每个问题最多尝试 3 次，然后停止。

1. **记录失败的原因**：
- 您尝试过的方法
- 具体的错误消息
- 您认为失败的原因

2. **研究替代方案**：
- 找到 2-3 个类似的实现
- 记录使用的不同方法

3. **问题基础**：
- 这是正确的抽象级别吗？
- 可以拆分成更小的问题吗？
- 有没有更简单的方法？

4. **尝试不同的角度**：
- 不同的库/框架特性？
- 不同的架构模式？
- 删除抽象而不是添加抽象？

## 技术标准

### 架构原则

- **组合优于继承** - 使用依赖注入
- **接口优于单例** - 启用测试并提高灵活性
- **显式优于隐式** - 清晰的数据流和依赖关系
- **尽可能进行测试驱动** - 切勿禁用测试，并进行修复

### 代码质量

- **每次提交必须**：
- 成功编译
- 通过所有现有测试
- 包含新功能的测试
- 遵循项目格式化/linting

- **提交前**：
- 运行格式化程序/linting
- 自我审查变更
- 确保提交信息解释“原因”

### 错误处理

- 使用描述性消息快速失败
- 包含调试上下文
- 在适当的级别处理错误
- 切勿默默地吞噬异常

## 决策框架

当存在多种有效方法时，请基于以下因素进行选择：

1. **可测试性** - 我可以轻松测试吗？
2. **可读性** - 六个月后有人会理解吗？
3. **一致性** - 这是否符合项目模式？
4. **简单性** - 这是最简单的可行解决方案吗？
5. **可逆性** - 后续修改难度如何？

## 项目集成

### 学习代码库

- 找到 3 个相似的功能/组件
- 识别常见的模式和约定
- 尽可能使用相同的库/实用程序
- 遵循现有的测试模式

### 工具

- 使用项目现有的构建系统
- 使用项目的测试框架
- 使用项目的格式化程序/linter 设置
- 如果没有充分的理由，请勿引入新工具

## 质量门

### 完成的定义

- [ ] 测试已编写并通过
- [ ] 代码遵循项目约定
- [ ] 没有 linter/格式化程序警告
- [ ] 提交消息清晰
- [ ] 实现符合计划
- [ ] 没有没有问题编号的 TODO

### 测试指南

- 测试行为，而不是实现
- 尽可能每个测试使用一个断言
- 清晰地描述场景的测试名称
- 使用现有的测试实用程序/助手
- 测试应具有确定性

## 重要提醒

**切勿**：
- 使用 `--no-verify` 来绕过提交钩子
- 禁用测试而不是修复它们
- 提交无法编译的代码
- 做出假设 - 使用现有代码进行验证

**始终**：
- 逐步提交可运行的代码
- 随时更新计划文档
- 从现有实现中学习
- 三次失败后停止并重新评估